<page-header [header]="header"></page-header>

<div class="row">
  <div class="col-xs-12">
    <div class="card-box">
      <div class="row">
        <md-toolbar class="toolbar">
          <span (click)="back()"><i class="fa fa-chevron-left" aria-hidden="true"></i></span>
          <span class="toolbar-spacer"></span>
          <span *ngIf="editable()" class="toolbar-icon"><md-icon (click)="save()">save</md-icon></span>
          <span *ngIf="editable()" class="toolbar-icon"><md-icon (click)="done()">done</md-icon></span>
          <span *ngIf="editable()" class="toolbar-icon tc-red-800"><md-icon (click)="delete()">delete</md-icon></span>
        </md-toolbar>
      </div>
      <div class="row">
        <div class="col-md-4 col-sm-6 col-xs-10">
          <md-input-container class="md-input-full-width">
            <input mdInput name="name" [(ngModel)]="current.sn" placeholder="SN" disabled>
          </md-input-container>
        </div>
        <div class="col-md-4 col-sm-6 col-xs-10">
          <md-input-container class="md-input-full-width">
            <input mdInput name="date" [(ngModel)]="current.date" placeholder="Date" disabled>
          </md-input-container>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 col-sm-6 col-xs-10">
          <md-input-container class="md-input-full-width">
            <input mdInput name="status" [(ngModel)]="current.statusdesc" placeholder="Status" disabled>
          </md-input-container>
        </div>
        <div class="col-md-4 col-sm-6 col-xs-10">
          <md-input-container class="md-input-full-width">
            <input mdInput name="customer" placeholder="Customer" [formControl]="formControlCustomer" [mdAutocomplete]="auto">
            <md-error *ngIf="formControlCustomer.hasError('required')">
              Customer is <strong>required</strong>
            </md-error>
            <md-error *ngIf="formControlCustomer.hasError('object')">
              Invalid customer
            </md-error>
          </md-input-container>
          <md-autocomplete #auto="mdAutocomplete" [displayWith]="display">
            <md-option *ngFor="let option of filteredOptions | async" [value]="option">
              {{ option.name }}
            </md-option>
          </md-autocomplete>
          <input type="hidden">
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 col-sm-6 col-xs-10">
          <md-input-container class="md-input-full-width">
            <textarea mdInput name="remark" [(ngModel)]="current.remark" [formControl]="formControlRemark" placeholder="Remark" rows="1"
              maxlength="200"></textarea>
            <md-hint align="end">{{current.remark.length}} / 200</md-hint>
          </md-input-container>
        </div>
      </div>
    </div>
    <div class="card-box" *ngIf="!showlist">
      <div class="row">
        <md-toolbar class="toolbar">
          <span><i class="fa fa-th-list" aria-hidden="true"></i></span>
          <span class="toolbar-spacer"></span>
          <span class="toolbar-icon"><md-icon *ngIf="editable()" (click)="shopping(current.id)" class="tc-grey-800">add_shopping_cart</md-icon></span>
        </md-toolbar>
      </div>
      <div class="row">
        <div class="col-xs-10">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>Unit Price</th>
                  <th>Qty.</th>
                  <th>Amount</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="current.items.length==0">
                  <td class="text-center md-caption tc-grey-400" colspan="6">No Record(s)</td>
                </tr>
                <tr *ngFor="let item of current.items;let i=index;">
                  <td>{{i+1}}</td>
                  <td>{{item.name}}</td>
                  <td>{{item.unitprice | number:'1.2-2'}}</td>
                  <td>{{item.qty | number:'1.2-2'}}</td>
                  <td>{{item.unitprice*item.qty | number:'1.2-2'}}</td>
                  <td class="text-right">
                    <span *ngIf="editable()" class="tc-red-800" (click)="deleteItem(item.id)"><i class="fa fa-times" aria-hidden="true"></i></span>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th class="text-right">Total:</th>
                  <th>{{ total() | number:'1.2-2'}}</th>
                  <th></th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="card-box" *ngIf="showlist">
      <div class="row">
        <md-toolbar class="toolbar">
          <span class="toolbar-icon-back" *ngIf="!searchBox.searchVisible" (click)="cancel()"><i class="fa fa-times" aria-hidden="true"></i></span>
          <td-search-box #searchBox backIcon="arrow_back" placeholder="Search here" (searchDebounce)="search($event)" flex>
          </td-search-box>
        </md-toolbar>
      </div>
      <div class="row">
        <div class="row">
          <div class="col-xs-10">
            <td-data-table #dataTable [data]="filteredData" [columns]="columns" [selectable]="selectable" [multiple]="multiple" [sortable]="true"
              [clickable]="clickable" [sortBy]="sortBy" [(ngModel)]="selectedRows" [sortOrder]="sortOrder" (sortChange)="sort($event)">
              <ng-template tdDataTableTemplate="tags" let-value="value" let-row="row" let-column="column">
                <div layout="row">
                  <md-chip-list>
                    <md-chip *ngFor="let item of value">
                      <span mdTooltip="{{item.name}}">{{ item.value }}</span>
                    </md-chip>
                  </md-chip-list>
                </div>
              </ng-template>
              <ng-template tdDataTableTemplate="price" let-value="value" let-row="row" let-column="column">
                {{ value.amount | number:'1.2-2'}}
              </ng-template>
              <ng-template tdDataTableTemplate="id" let-value="value" let-row="row" let-column="column">
                <div *ngIf="row.price" layout="row" layout-align="end end">
                  <button md-icon-button (click)="add(value,row.price.id)"><md-icon>add_shopping_cart</md-icon></button>
                </div>
              </ng-template>
            </td-data-table>
            <div class="md-padding" *ngIf="!dataTable.hasData" layout="row" layout-align="center center">
              <span class="md-caption tc-grey-400">No Product(s) for Sale.</span>
            </div>
            <td-paging-bar #pagingBar [pageSizes]="[5, 10, 15, 20]" [total]="filteredTotal" (change)="page($event)">
              <span td-paging-bar-label hide-xs>Page</span> {{pagingBar.range}} <span hide-xs>of {{pagingBar.total}}</span>
            </td-paging-bar>
          </div>
        </div>
      </div>
    </div>
  </div>
